<!DOCTYPE html>
<html lang="zh">
<head>
   <script src="https://fastly.jsdelivr.net/npm/chart.js"></script>
  <meta charset="UTF-8">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºèƒ½è½¦æµåˆ†æç³»ç»Ÿ</title>
  <!-- å¤–éƒ¨CSSå¼•ç”¨ -->
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      text-align: center;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
    }
    .video-container {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .video-box {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      width: 45%;
      margin-bottom: 20px;
    }
    video {
      width: 100%;
      border-radius: 5px;
      max-height: 300px;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      background: white;
    }
    table, th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #007BFF;
      color: white;
    }
    .stats-container {
      margin-top: 20px;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .loading {
      display: none;
      font-size: 18px;
      color: #007BFF;
      margin-top: 10px;
    }
    .progress-container {
      width: 100%;
      background: #eee;
      border-radius: 10px;
      overflow: hidden;
      height: 20px;
      margin-top: 10px;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: #007BFF;
      color: white;
      text-align: center;
      line-height: 20px;
      transition: width 0.3s;
    }
    .qa-container {
      margin-top: 30px;
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      text-align: left;
    }
    #chartPanel {
  transition: all 0.3s ease;
    }

    #trafficChart {
  max-width: 100%;
  height: auto;
   }
    textarea {
      width: 100%;
      height: 80px;
      padding: 10px;
      font-size: 16px;
      resize: vertical;
    }
    .qa-button {
      margin-top: 10px;
      padding: 10px 20px;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .qa-button:hover {
      background: #0056b3;
    }
    .qa-output {
      margin-top: 10px;
      background: #fff;
      padding: 10px;
      border-radius: 5px;
      min-height: 60px;
      border: 1px solid #ccc;
    }
    .upload-btn {
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .upload-btn:hover {
      background: #218838;
    }
    .error-message {
      color: #dc3545;
      margin-top: 10px;
    }
    .success-message {
      color: #28a745;
      margin-top: 10px;
    }
    @media (max-width: 768px) {
      .video-box {
        width: 100%;
      }
    }
    /* å†å²çœ‹æ¿æ ·å¼ */
.dashboard-modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.7);
  overflow: auto;
}

.dashboard-content {
  background-color: #fefefe;
  margin: 5% auto;
  padding: 20px;
  border-radius: 10px;
  width: 80%;
  max-width: 1000px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.close-dashboard {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.dashboard-summary {
  margin-bottom: 20px;
  padding: 15px;
  background: #f5f5f5;
  border-radius: 8px;
}

.summary-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 15px;
}

.summary-item {
  background: white;
  padding: 15px;
  border-radius: 5px;
  text-align: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.summary-label {
  display: block;
  font-size: 14px;
  color: #666;
  margin-bottom: 5px;
}

.summary-value {
  display: block;
  font-size: 24px;
  font-weight: bold;
  color: #007BFF;
}

.dashboard-history table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

.dashboard-history th, .dashboard-history td {
  padding: 12px;
  text-align: center;
  border: 1px solid #ddd;
}

.dashboard-history th {
  background-color: #007BFF;
  color: white;
}

.dashboard-history tr:nth-child(even) {
  background-color: #f2f2f2;
}

.dashboard-history tr:hover {
  background-color: #e9e9e9;
}
/* å›¾è¡¨å¼¹çª—æ ·å¼ */
.modal {
  display: none;
  position: fixed;
  z-index: 1002;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.7);
}

.modal-content {
  background-color: #fefefe;
  margin: 5% auto;
  padding: 20px;
  border-radius: 8px;
  width: 70%;
  max-width: 800px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.close:hover {
  color: black;
}
/* éšè—æ‘©æ‰˜è½¦åˆ— */

.chart-container {
  position: relative;
  width: 100%;
  height: 60vh;
  min-height: 400px;
}

.dashboard-btn {
  margin-top: 20px;
  padding: 10px 20px;
  background: #6c757d;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.3s;
}

.dashboard-btn:hover {
  background: #5a6268;
}

.action-btn {
  padding: 5px 10px;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  margin: 0 2px;
}

.view-btn {
  background: #17a2b8;
  color: white;
}

.delete-btn {
  background: #dc3545;
  color: white;
}
  </style>
</head>
<body>
  <div class="container">
    <h2>è½¦è¾†æ£€æµ‹è§†é¢‘å¤„ç†ï¼ˆä¼˜åŒ–ç‰ˆï¼‰</h2>

    <div>
      <input type="file" id="videoUpload" accept="video/*">
      <button class="upload-btn" onclick="startUpload()">å¼€å§‹å¤„ç†</button>
      <p class="loading" id="loadingText">å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</p>
      <p id="statusMessage" class="success-message"></p>
      <div class="progress-container">
        <div class="progress-bar" id="progressBar">0%</div>
      </div>
    </div>

    <div class="video-container">
      <div class="video-box">
        <h3>åŸå§‹è§†é¢‘</h3>
        <video id="originalVideo" controls></video>
      </div>
      <div class="video-box">
        <h3>å¤„ç†åçš„è§†é¢‘</h3>
        <video id="processedVideo" controls></video>
        <br>
        <a id="downloadLink" style="display:none;" class="download-btn" download="processed_video.mp4">ä¸‹è½½å¤„ç†åçš„è§†é¢‘</a>
      </div>
    </div>

    <div class="stats-container">
       <h3>è½¦è¾†æ£€æµ‹ç»Ÿè®¡</h3>
  <table>
    <tr>
      <th>æ€»æ£€æµ‹è½¦è¾†æ•°</th>
      <th>æ¯ç§’æ–°å¢è½¦è¾†</th>
      <th>æ‹¥å µæŠ¥è­¦æ¬¡æ•°</th>
      <th>è¯†åˆ«æˆåŠŸè½¦è¾†æ•°</th>
      <th>è¯†åˆ«å¤±è´¥è½¦è¾†æ•°</th>
      <th>å½“å‰é¡µé¢è½¦è¾†æ€»æ•°</th>
    </tr>
    <tr>
      <td id="total-vehicles">-</td>
      <td id="new-vehicles">-</td>
      <td id="congestion-alerts">-</td>
      <td id="detected-vehicles">-</td>
      <td id="failed-vehicles">-</td>
      <td id="last_fame_count">-</td>
    </tr>
    <!-- æ·»åŠ è¿™è¡Œæ˜¾ç¤ºå®æ—¶æ‹¥å µçŠ¶æ€ -->
    <tr>
      <td colspan="6" id="congestion-status" style="text-align: center; font-weight: bold;">
        äº¤é€šçŠ¶æ€: ç­‰å¾…æ•°æ®...
      </td>
    </tr>
  </table>
      <h3>è½¦è¾†åˆ†ç±»ç»Ÿè®¡</h3>
      <table>
        <tr>
          <th>è½¿è½¦</th>
          <th>å¡è½¦</th>
          <th>è¿è¡Œé”™è¯¯æ¬¡æ•°</th>
          <th>å…¬äº¤è½¦</th>
          <th>å…¶ä»–</th>
        </tr>
        <tr>
          <td id="car-count">-</td>
          <td id="truck-count">-</td>
          <td id="motorcycle-count">-</td>
          <td id="bus-count">-</td>
          <td id="other-count">-</td>
        </tr>
      </table>

      <h3>è¿è¡Œæ•°æ®ç»Ÿè®¡</h3>
      <table>
        <tr>
          <th>è¿è¡Œæ—¶é—´ (ç§’)</th>
          <th>å¤„ç†å¸§æ•°</th>
          <th>å¹³å‡å¤„ç†æ—¶é—´ (æ¯«ç§’/å¸§)</th>
          <th>æœ€å¤§å†…å­˜å ç”¨ (MB)</th>
        </tr>
        <tr>
          <td id="runtime">-</td>
          <td id="frame-count">-</td>
          <td id="avg-frame-time">-</td>
          <td id="max-memory">-</td>
        </tr>
      </table>
      <h3>æ‹¥å µæ§åˆ¶</h3>
      <table>
        <tr>
          <th>æ‹¥å µæŒ‡æ•°</th>
          <th>æ‹¥å µç­‰çº§</th>

        </tr>
        <tr>
           <td id="congestion-index">-</td>
           <td id="congestion-level">-</td>
        </tr>
      </table>
    </div>
<button class="qa-button" onclick="toggleChartPanel()">
  <span>ğŸ“Š æŸ¥çœ‹å®æ—¶å›¾è¡¨</span>
</button>
<button class="open-qa-btn" onclick="openQA()">æ‰“å¼€æ•°æ®ç»¼åˆé—®ç­”</button>
  </div>

 <div class="qa-container" id="qaContainer" style="display: none;">
  <button class="close-qa-btn" onclick="closeQA()">Ã—</button>
  <h3>æ•°æ®ç»¼åˆé—®ç­”</h3>
  <textarea id="questionInput" placeholder="è¯·è¾“å…¥ä½ çš„é—®é¢˜ï¼Œå¦‚ï¼šè¯†åˆ«å¤±è´¥æœ€å¤šçš„æ˜¯å“ªç±»è½¦ï¼Ÿ"></textarea>
  <div class="button-group">
    <button class="qa-button" onclick="askQuestion()">å¼€å§‹é—®ç­”</button>
    <button class="qa-button" id="startRecognition" onclick="startSpeechRecognition()">
      <span id="micIcon">ğŸ¤</span> <span id="recognitionText">è¯­éŸ³è¾“å…¥</span>
    </button>
    <!-- æ·»åŠ å†å²è®°å½•æŒ‰é’® -->
    <button class="qa-button" onclick="showHistory()">
      <span>ğŸ“œ å†å²è®°å½•</span>
    </button>
  </div>
  <div id="answerOutput" class="qa-output">AIå›ç­”å°†åœ¨æ­¤æ˜¾ç¤º...</div>

  <!-- æ·»åŠ å†å²è®°å½•å¼¹å‡ºå®¹å™¨ -->
  <div id="historyContainer" class="history-container" style="display: none;">
    <button class="close-history-btn" onclick="closeHistory()">Ã—</button>
    <h3>å†å²è®°å½•</h3>
    <div id="historyList" class="history-list">
      <!-- å†å²è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>
</div>
<!-- å†å²çœ‹æ¿å¼¹å‡ºçª—å£ -->
<div id="historyDashboard" class="dashboard-modal" style="display: none;">
  <div class="dashboard-content">
    <span class="close-dashboard" onclick="closeDashboard()">&times;</span>
    <h2>æ£€æµ‹å†å²è®°å½•çœ‹æ¿</h2>

    <div class="dashboard-summary">
      <h3>æ±‡æ€»ç»Ÿè®¡</h3>
      <div class="summary-grid">
        <div class="summary-item">
          <span class="summary-label">æ€»æ£€æµ‹æ¬¡æ•°</span>
          <span class="summary-value" id="total-detections">0</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">æ€»æ£€æµ‹è½¦è¾†æ•°</span>
          <span class="summary-value" id="total-vehicles-detected">0</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">æ€»æ‹¥å µæŠ¥è­¦æ•°</span>
          <span class="summary-value" id="total-congestion-alerts">0</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">æ€»è¯†åˆ«å¤±è´¥æ•°</span>
          <span class="summary-value" id="total-failed-detections">0</span>
        </div>
      </div>
    </div>

    <div class="dashboard-history">
      <h3>å†å²è®°å½•</h3>
      <table id="historyTable">
        <thead>
          <tr>
            <th>åºå·</th>
            <th>æ£€æµ‹æ—¶é—´</th>
            <th>è§†é¢‘åç§°</th>
            <th>è½¦è¾†æ€»æ•°</th>
            <th>æ‹¥å µæŒ‡æ•°</th>
            <th>æ‹¥å µç­‰çº§</th>
            <th>æŠ¥è­¦æ¬¡æ•°</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="historyTableBody">
          <!-- å†å²è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- åœ¨å®¹å™¨ä¸­æ·»åŠ å†å²çœ‹æ¿æŒ‰é’® -->
  <!-- åœ¨container divå†…çš„é€‚å½“ä½ç½®æ·»åŠ  -->

<div class="container">
  <!-- å…¶ä»–ç°æœ‰ä»£ç ... -->
  <button class="dashboard-btn" onclick="openDashboard()">æŸ¥çœ‹å†å²è®°å½•çœ‹æ¿</button>
</div>

<!-- æ–°å¢é®ç½©å±‚ -->
<div id="overlay" class="overlay" onclick="closeHistory()"></div>

<!-- åœ¨bodyåº•éƒ¨æ·»åŠ ï¼Œä¸å…¶ä»–å¼¹çª—åŒçº§ -->
<div id="chartModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeChartModal()">&times;</span>
    <h3>å®æ—¶äº¤é€šç»Ÿè®¡</h3>
    <div class="chart-container">
      <canvas id="trafficChart"></canvas>
    </div>
  </div>
</div>
  <script src="app.js"></script>
</body>
</html>